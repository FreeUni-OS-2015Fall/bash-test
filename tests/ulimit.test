#! /bin/bash

tmp_file=$(mktemp -t ulimit)
$UNDER_TEST -c "ulimit -a" | tee $tmp_file

line_num=$(cat $tmp_file | wc -l)
if [ $line_num -ne 16 ]; then
  >&2 echo "ulimit -a does not output 16 lines"
  exit 1
fi

flags=( '-c' '-d' '-u' '-f' '-v' '-e' )
for i in "${flags[@]}"
do
  ulimit_res=$($UNDER_TEST -c "ulimit $i")
  if [ -z "$ulimit_res" ]; then
    >&2 echo "ulimit $i value empty"
    exit 1
  fi
done

rm $tmp_file
exit 0
