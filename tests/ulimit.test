#! /bin/bash

line_num=$($UNDER_TEST -c "ulimit -a" | wc -l)
if [ $line_num -ne 16 ]; then
  >&2 echo "ulimit -a does not output 16 lines"
  exit 1
fi

flags=( '-q' '-u' '-p' '-s' '-e' )
for i in "${flags[@]}"
do
  ulimit_res=$($UNDER_TEST -c "ulimit $i")
  if [ -z "$ulimit_res" ]; then
    >&2 echo "ulimit $i value empty"
    exit 1
  fi
done

ulimit_res=$($UNDER_TEST -c "ulimit -n 1025; ulimit -n")
if [ $ulimit_res -ne 1025 ]; then
  >&2 echo "ulimit -n returned incorrect value"
  exit 1
fi

ulimit_res=$(ulimit -s 100; $UNDER_TEST -c "ulimit -s")
if [ $ulimit_res -ne 100 ]; then
  >&2 echo "ulimit -s returned incorrect value"
  exit 1
fi

exit 0
